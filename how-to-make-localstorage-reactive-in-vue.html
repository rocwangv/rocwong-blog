<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>「译」在Vue中如何使localstorage变为响应式 | RocWong&#39;s Blog</title>
  
  <meta name="keywords" content="前端,移动端,技术分享,算法,总结,react-native,RocWong,rocwong,rocwong-cn,王鹏的博客,rocwong's blog,rocwang,flutter,linux">
  
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  

  
  <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
    <div id="loading-bar-wrapper">
  <div id="loading-bar" class="pure"></div>
</div>

    <script>setLoadingBarProgress(20)</script>
    <header class="l_header pure">
	<div class="wrapper">
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href="/">
        
          RocWong's Blog
        
      </a>
			<div class="menu">
				<ul class="h-list">
          
  					
  						<li>
								<a id="home" class="nav flat-box" href="/">
									<i class="fas fa-home fa-fw"></i>&nbsp;主页
								</a>
							</li>
      			
  						<li>
								<a id="archives" class="nav flat-box" href="/archives/">
									<i class="fas fa-archive fa-fw"></i>&nbsp;归档
								</a>
							</li>
      			
  						<li>
								<a id="books" class="nav flat-box" href="/books/">
									<i class="fas fa-book fa-fw"></i>&nbsp;书单
								</a>
							</li>
      			
  						<li>
								<a id="mind" class="nav flat-box" href="/mind/">
									<i class="fas fa-bolt fa-fw"></i>&nbsp;思维
								</a>
							</li>
      			
  						<li>
								<a id="project" class="nav flat-box" href="/project/">
									<i class="fas fa-gavel fa-fw"></i>&nbsp;项目
								</a>
							</li>
      			
  						<li>
								<a id="friends" class="nav flat-box" href="/friends/">
									<i class="fas fa-link fa-fw"></i>&nbsp;友链
								</a>
							</li>
      			
  						<li>
								<a id="about" class="nav flat-box" href="/about/">
									<i class="fas fa-user fa-fw"></i>&nbsp;关于
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索">
						<span class="icon"><i class="fas fa-search fa-fw"></i></span>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li>
				
				<li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>

		<div class="nav-sub container container--flex">
			<a class="logo flat-box"></a>
			<ul class="switcher h-list">
				<li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li>
				<li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu">
      <ul>
          
              
                  <li>
										<a id="home" class="nav flat-box" href="/">
											<i class="fas fa-home fa-fw"></i>&nbsp;主页
										</a>
                  </li>
              
                  <li>
										<a id="archives" class="nav flat-box" href="/archives/">
											<i class="fas fa-archive fa-fw"></i>&nbsp;归档
										</a>
                  </li>
              
                  <li>
										<a id="books" class="nav flat-box" href="/books/">
											<i class="fas fa-book fa-fw"></i>&nbsp;书单
										</a>
                  </li>
              
                  <li>
										<a id="mind" class="nav flat-box" href="/mind/">
											<i class="fas fa-bolt fa-fw"></i>&nbsp;思维
										</a>
                  </li>
              
                  <li>
										<a id="project" class="nav flat-box" href="/project/">
											<i class="fas fa-gavel fa-fw"></i>&nbsp;项目
										</a>
                  </li>
              
                  <li>
										<a id="friends" class="nav flat-box" href="/friends/">
											<i class="fas fa-link fa-fw"></i>&nbsp;友链
										</a>
                  </li>
              
                  <li>
										<a id="about" class="nav flat-box" href="/about/">
											<i class="fas fa-user fa-fw"></i>&nbsp;关于
										</a>
                  </li>
              
       
      </ul>
		</nav>
    </header>
	</aside>

    <script>setLoadingBarProgress(40);</script>
    <div class="l_body">
    <div class='container clearfix'>
        <div class='l_main'>
            <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
  
<section class="meta">
  
  
  <div class="meta" id="header-meta">
    
      
          <h1 class="title">「译」在Vue中如何使localstorage变为响应式</h1>
      
    

    <div class="new-meta-box">
      
        <div class="new-meta-item author">
          <a href="http://www.rocwong.cn">
            <i class="fas fa-user" aria-hidden="true"></i>
            RocWong
          </a>
        </div>
      
      
        <div class="new-meta-item date">
          <a class="notlink">
            <i class="fas fa-calendar-alt" aria-hidden="true"></i>
            2020-08-13
          </a>
        </div>
      
      
        
          
          <div class="new-meta-item category">
            <a href="/categories/译文/">
              <i class="fas fa-folder-open" aria-hidden="true"></i>
              译文
            </a>
          </div>
        
      
      
        
          <div class="new-meta-item browse busuanzi">
            <a class="notlink">
              <i class="fas fa-eye" aria-hidden="true"></i>
              <span id="busuanzi_value_page_pv">
                <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
              </span>
            </a>
          </div>
        
      
      
    </div>
    <hr>
  </div>
</section>

    <section class="article typo">
      <div class="article-entry" itemprop="articleBody">
        <blockquote>
<p>原文作者：<a href="https://css-tricks.com/author/hunorborbely/" target="_blank" rel="noopener">Hunor Márton Borbély</a><br>发布时间：Jun 24, 2020<br>原文地址：<a href="https://css-tricks.com/how-to-make-localstorage-reactive-in-vue/" target="_blank" rel="noopener">How to Make localStorage Reactive in Vue</a></p>
</blockquote>
<p>响应式是Vue的最伟大的特性之一，如果你不知道它在幕后做了什么，那么它对于你来说会显得更加神秘。就像为什么它只适用于对象和数组，而不适用于其他东西呢，比如我们今天所说的<code>localstorage</code>。</p>
 <a id="more"></a>
<p>接下来，让我们一起来回答这个问题。同时，也让<code>localstorage</code>变为响应式的。</p>
<p>如果你<a href="https://domlr.vercel.app/demo1.html" target="_blank" rel="noopener">运行下面代码</a>，则会看到<code>counter</code>的显示为静态值，不会因为在<code>setInterval</code>中修改了<code>localstorage</code>中的值而作用到页面中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#counter"</span>,</span><br><span class="line">  data: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    counter: localStorage.getItem(<span class="string">"counter"</span>)</span><br><span class="line">  &#125;),</span><br><span class="line">  computed: &#123;</span><br><span class="line">    even() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.counter % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;Counter: &#123;&#123; counter &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;Counter is &#123;&#123; even ? 'even' : 'odd' &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// some-other-file.js</span></span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> counter = localStorage.getItem(<span class="string">"counter"</span>);</span><br><span class="line">  localStorage.setItem(<span class="string">"counter"</span>, +counter + <span class="number">1</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>如何使<code>localstorage</code>中的值发生变更时，同步更新页面中<code>counter</code>的数据呢？</p>
<p>对此我们有多重解决方案，最常用的方案是使用<code>Vuex</code>并保持<code>store</code>和<code>localstorage</code>中的数据同步。 但是如果我们需要更简单的东西（例如本例中的东西）怎么办？ 那就需要我们深入研究Vue的响应式系统是如何工作的。</p>
<h2 id="Vue-中的响应式系统"><a href="#Vue-中的响应式系统" class="headerlink" title="Vue 中的响应式系统"></a>Vue 中的响应式系统</h2><p>当Vue初始化组件实例时，它会<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/instance/state.js#L151" target="_blank" rel="noopener">监听data项的变化</a>。这意味着它将<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/index.js#L64" target="_blank" rel="noopener">遍历</a> data 中的所有属性，并使用<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/index.js#L157" target="_blank" rel="noopener">Object.defineProperty</a>将它们转换为 <code>getter/setter</code>，通过为每个属性设置一个自定义的<code>setter</code>，Vue就可以监测到每个属性的变化，并且<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/index.js#L191" target="_blank" rel="noopener">通知</a>那些需要响应变化的依赖项。它是如何将依赖项和属性之间进行建联的呢？ 通过利用<code>getters</code>进行<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/index.js#L163" target="_blank" rel="noopener">注册</a>依赖，当触发 <code>computed</code>、<code>watch</code>和<code>render function</code>等行为时。</p>
<p>以上流程简写为代码的话，如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core/instance/state.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initData</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  observe(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// core/observer/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observe</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">new</span> Observer(value)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">constructor</span> (value) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">this</span>.walk(value)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  walk (obj) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">      defineReactive(obj, keys[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span> (<span class="params">obj, key, ...</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      dep.depend()</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>(newVal) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      dep.notify()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那么， 为何<code>localstorage</code>不是响应式的呢？ <strong>因为他不是一个具备属性的对象。</strong></p>
<p>但是，我们也不能用数组定义<code>getter</code>和<code>setter</code>，那为什么Vue中的数组仍然是响应式的呢？ 这是因为数组是Vue中的特例。为了具备响应式数组，<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/array.js#L27" target="_blank" rel="noopener">Vue在后台重写了数组的方法</a>，并将它们与vue的响应式系统一起<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/array.js#L42" target="_blank" rel="noopener">打了个补丁</a>。</p>
<p>那我们可以在<code>localstorage</code>上做些类似的事情吗？</p>
<h2 id="重写-localstorage-的方法"><a href="#重写-localstorage-的方法" class="headerlink" title="重写 localstorage 的方法"></a>重写 localstorage 的方法</h2><p>首先尝试通过重写localStorage的方法来<a href="https://domlr.vercel.app/demo2.html" target="_blank" rel="noopener">修复上面的demo</a>，以追踪那些组件实例请求了<code>localstorage</code>的数据项。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// localStorage项键和依赖它的Vue实例列表之间的映射</span></span><br><span class="line">  <span class="keyword">const</span> storeItemSubscribers = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getItem = <span class="built_in">window</span>.localStorage.getItem;</span><br><span class="line">  localStorage.getItem = <span class="function">(<span class="params">key, target</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">"Getting"</span>, key);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 收集依赖的Vue实例</span></span><br><span class="line">    <span class="keyword">if</span> (!storeItemSubscribers[key]) storeItemSubscribers[key] = [];</span><br><span class="line">    <span class="keyword">if</span> (target) storeItemSubscribers[key].push(target);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用原始方法</span></span><br><span class="line">    <span class="keyword">return</span> getItem.call(localStorage, key);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> setItem = <span class="built_in">window</span>.localStorage.setItem;</span><br><span class="line">  localStorage.setItem = <span class="function">(<span class="params">key, value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">"Setting"</span>, key, value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新依赖vue实例中的值</span></span><br><span class="line">    <span class="keyword">if</span> (storeItemSubscribers[key]) &#123;</span><br><span class="line">      storeItemSubscribers[key].forEach(<span class="function">(<span class="params">dep</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (dep.hasOwnProperty(key)) dep[key] = value;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用原始方法</span></span><br><span class="line">    setItem.call(localStorage, key, value);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#counter"</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      counter: localStorage.getItem(<span class="string">"counter"</span>, <span class="keyword">this</span>) <span class="comment">// We need to pass 'this' for now</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    even() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.counter % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`&lt;div&gt;</span></span><br><span class="line"><span class="string">  &lt;div&gt;Counter: &#123;&#123; counter &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;div&gt;Counter is &#123;&#123; even ? 'even' : 'odd' &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;`</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> counter = localStorage.getItem(<span class="string">"counter"</span>);</span><br><span class="line">  localStorage.setItem(<span class="string">"counter"</span>, +counter + <span class="number">1</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>在此示例中，我们重新定义<code>getItem</code>，<code>setItem</code>以便收集和通知依赖于<code>localStorage item</code>的组件。在新版本<code>getItem</code>，我们会记录哪个组件请求哪个<code>item</code>，而在<code>setItems</code>中，我们访问所有请求该项目的组件并重写其<code>data prop</code>。</p>
<p>为了使上面的代码起作用，我们必须将对组件实例的引用传递给<code>getItem</code>并更改其函数签名。我们也不能再使用箭头功能，因为否则我们将无法拿到正确的的<code>this</code>值。</p>
<p>如果我们想做得更好，就必须更深入地挖掘。例如，我们如何在不显式传递依赖者的情况下跟踪它们？</p>
<h2 id="Vue如何收集依赖关系"><a href="#Vue如何收集依赖关系" class="headerlink" title="Vue如何收集依赖关系"></a>Vue如何收集依赖关系</h2><p>为了获得启发，我们可以回到Vue的响应式系统。先前我们看到，访问数据属性时，数据属性的getter将使调用者<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/index.js#L163" target="_blank" rel="noopener">订阅</a>该属性的进一步更改。但是如何知道是谁调用的呢？当我们得到一个data时，它的getter函数没有任何关于调用者是谁的输入。Getter函数<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/index.js#L160" target="_blank" rel="noopener">没有输入</a>。它如何知道将谁注册为依赖项的呢？ </p>
<p>每个data属性维护一个需要在<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/index.js#L142" target="_blank" rel="noopener">Dep类</a>中进行响应的依赖项列表。如果我们深入研究此类，我们可以看到，只要<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/dep.js#L33" target="_blank" rel="noopener">注册</a>了依赖项，就已经在<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/dep.js#L14" target="_blank" rel="noopener">static target</a>变量中定义了依赖项。这个目标是由一个非常神秘的<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/watcher.js#L102" target="_blank" rel="noopener">Watcher</a>设置的。实际上，当数据属性更改时，将实际上<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/observer/dep.js#L47" target="_blank" rel="noopener">通知</a>这些观察程序，并且它们将启动组件的重新呈现或计算属性的重新计算。</p>
<p>当Vue使该data选项observable时，它还会为每个<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/instance/state.js#L187" target="_blank" rel="noopener">计算属性</a>函数以及所有<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/instance/state.js#L356" target="_blank" rel="noopener">watch函数</a>（不应与Watcher类混淆）以及每个<a href="https://github.com/vuejs/vue/blob/0baa129d4cad44cf1847b0eaf07e95d4c71ab494/src/core/instance/lifecycle.js#L197" target="_blank" rel="noopener">组件实例</a>的render函数创建监视者。观察者就像这些功能的伴侣。他们主要做两件事：</p>
<ul>
<li><strong>它们在创建时会评估函数</strong>。这将触发依赖项的收集。</li>
<li><strong>当通知他们所依赖的值已更改时，他们将重新运行其功能。</strong> 这最终将重新计算一个计算属性或重新渲染整个组件。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/rocwong-cn/assets/vue/vue-reactive.png" alt></p>
<p>在观察者调用其负责的功能之前，有一个重要的步骤发生了：他们将自己设置为Dep类中静态变量的目标。这样可以确保在访问反应性数据属性时将它们注册为依赖。</p>
<h2 id="持续追踪谁调用了localstorage"><a href="#持续追踪谁调用了localstorage" class="headerlink" title="持续追踪谁调用了localstorage"></a>持续追踪谁调用了localstorage</h2><p>我们无法<em>完全</em>做到这一点，因为我们无法使用Vue的内部机制。但是，我们可以使用Vue 的思想，即观察者可以在调用其负责的功能之前，将目标设置为静态属性。在localStorage调用之前，我们可以设置对组件实例的引用吗？</p>
<p>如果我们假设localStorage在设置data选项时调用了该方法，那么我们可以将其连接到beforeCreate和中created。这两个钩子函数在初始化该data选项之前和之后都会被触发，因此我们可以设置一个目标变量，然后清除该变量，并引用当前组件实例（我们可以在生命周期钩子函数中访问该实例）。然后，在我们的自定义<code>getter</code>中，我们可以将该目标注册为依赖项。</p>
<p>我们要做的最后一点是使这些生命周期钩子成为我们所有组件的一部分。我们可以通过整个项目的全局<code>mixins</code>来做到这一点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A map between localStorage item keys and a list of Vue instances that depend on it</span></span><br><span class="line"><span class="keyword">const</span> storeItemSubscribers = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The Vue instance that is currently being initialised</span></span><br><span class="line"><span class="keyword">let</span> target = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getItem = <span class="built_in">window</span>.localStorage.getItem;</span><br><span class="line">localStorage.getItem = <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.info(<span class="string">"Getting"</span>, key);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Collect dependent Vue instance</span></span><br><span class="line">  <span class="keyword">if</span> (!storeItemSubscribers[key]) storeItemSubscribers[key] = [];</span><br><span class="line">  <span class="keyword">if</span> (target) storeItemSubscribers[key].push(target);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Call the original function</span></span><br><span class="line">  <span class="keyword">return</span> getItem.call(localStorage, key);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setItem = <span class="built_in">window</span>.localStorage.setItem;</span><br><span class="line">localStorage.setItem = <span class="function">(<span class="params">key, value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.info(<span class="string">"Setting"</span>, key, value);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Update the value in the dependent Vue instances</span></span><br><span class="line">  <span class="keyword">if</span> (storeItemSubscribers[key]) &#123;</span><br><span class="line">    storeItemSubscribers[key].forEach(<span class="function">(<span class="params">dep</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (dep.hasOwnProperty(key)) dep[key] = value;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Call the original function</span></span><br><span class="line">  setItem.call(localStorage, key, value);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"beforeCreate"</span>, <span class="keyword">this</span>._uid);</span><br><span class="line">    target = <span class="keyword">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"created"</span>, <span class="keyword">this</span>._uid);</span><br><span class="line">    target = <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>现在，当我们运行初始示例时，我们将获得一个计数器，该计数器每秒增加一个数字。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#counter"</span>,</span><br><span class="line">  data: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    counter: localStorage.getItem(<span class="string">"counter"</span>)</span><br><span class="line">  &#125;),</span><br><span class="line">  computed: &#123;</span><br><span class="line">    even() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.counter % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`&lt;div class="component"&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;Counter: &#123;&#123; counter &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;Counter is &#123;&#123; even ? 'even' : 'odd' &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> counter = localStorage.getItem(<span class="string">"counter"</span>);</span><br><span class="line">  localStorage.setItem(<span class="string">"counter"</span>, +counter + <span class="number">1</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<iframe id="cp_embed_qBZbrQE" src="//codepen.io/userId/embed/qBZbrQE?height=500px&theme-id=theme&slug-hash=qBZbrQE&default-tab=default_tabs&embed-version=2" scrolling="no" frameborder="no" height="500px" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 700px; overflow: hidden;"></iframe>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>当我们解决了最初的问题时，请记住这主要是一个思想实验。但是它还缺少一些功能，例如处理已删除的<code>item</code>和已卸载的组件实例。它还具有一些限制，例如组件实例的属性名称需要与<code>localStorage</code>中存储的<code>item</code>名称相同。也就是说，我们的主要目标是更好地了解Vue响应式系统在幕后的工作方式，并从中获得最大的收益。希望你也能有所收益。</p>
<p>如果想要进行数据持久化，可以使用<a href="https://github.com/championswimmer/vuex-persist" target="_blank" rel="noopener">vue-persist</a>。 如果您持续监听localStorage是否有所更改，则监听 <a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageEvent" target="_blank" rel="noopener">StorageEvent</a> 是一个更好的主意。</p>

      </div>
        
          <section class="meta" id="footer-meta">
            <hr>
            <div class="new-meta-box">
              
                <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-08-21T17:16:03+08:00">
                  <a class="notlink">
                    <i class="fas fa-pencil-alt" aria-hidden="true"></i>
                    2020-08-21
                  </a>
                </div>
              
              
                
                <div class="new-meta-item meta-tags"><a class="tag" href="/tags/vue/"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;vue</a></div>
              
              
            </div>
          </section>
        

        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                            <h4>
                                <a href="/labeled-tuple-element.html" rel="prev" title="「译」TypeScript 4.0 终于发布了我一直在等待的东西">
                                  
                                      「译」TypeScript 4.0 终于发布了我一直在等待的东西
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/typescript/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>typescript</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/brew-update-slowly.html" rel="prev" title="解决 brew update 时间太久的问题">
                                    
                                        解决 brew update 时间太久的问题
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/Homebrew/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>Homebrew</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        

    </section>

</article>

<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->


<br>

<!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      
      
        <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
        
        
        
          
            <section id="comments">
              <div id="valine_container" class="valine_thread">
                <i class="fas fa-spinner fa-spin fa-fw"></i>
              </div>
            </section>
          
        
      
    </section>
  </article>



<script>
    window.subData = {
        title: '「译」在Vue中如何使localstorage变为响应式',
        tools: true
    }
</script>


        </div>
        <aside class='l_side'>
            
  
  
    
      
      
        <section class="author">
  <div class="content pure">
    
      <div class="avatar">
        <img class="avatar" src="https://cdn.jsdelivr.net/gh/rocwong-cn/assets/avatar/avatar.png">
      </div>
    
    
    
      <div class="social-wrapper">
        
          
            <a href="mailto:me@rocwong.cn" class="social flat-btn" target="_blank" rel="external"><i class="social fas fa-envelope" aria-hidden="true"></i></a>
          
        
          
            <a href="https://github.com/rocwong-cn" class="social flat-btn" target="_blank" rel="external"><i class="social fab fa-github" aria-hidden="true"></i></a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=64405940" class="social flat-btn" target="_blank" rel="external"><i class="social fas fa-music" aria-hidden="true"></i></a>
          
        
      </div>
    
  </div>
</section>

      
    
  
    
      
      
        
  <section class="toc-wrapper">
    
<header class="pure">
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章目录</div>
  
    <div class="wrapper"><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div>
  
</header>

    <div class="content pure">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue-中的响应式系统"><span class="toc-text">Vue 中的响应式系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#重写-localstorage-的方法"><span class="toc-text">重写 localstorage 的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue如何收集依赖关系"><span class="toc-text">Vue如何收集依赖关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#持续追踪谁调用了localstorage"><span class="toc-text">持续追踪谁调用了localstorage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结束语"><span class="toc-text">结束语</span></a></li></ol>
    </div>
  </section>


      
    
  
    
      
      
        
  <section class="tagcloud">
    
<header class="pure">
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
</header>

    <div class="content pure">
      <a href="/tags/AI/" style="font-size: 14px; color: #999">AI</a> <a href="/tags/HTML5/" style="font-size: 14px; color: #999">HTML5</a> <a href="/tags/Homebrew/" style="font-size: 14px; color: #999">Homebrew</a> <a href="/tags/JS/" style="font-size: 24px; color: #555">JS</a> <a href="/tags/Jenkins/" style="font-size: 14px; color: #999">Jenkins</a> <a href="/tags/PWA/" style="font-size: 14px; color: #999">PWA</a> <a href="/tags/React-Native/" style="font-size: 14px; color: #999">React-Native</a> <a href="/tags/android/" style="font-size: 14px; color: #999">android</a> <a href="/tags/canvas/" style="font-size: 14px; color: #999">canvas</a> <a href="/tags/centos/" style="font-size: 14px; color: #999">centos</a> <a href="/tags/commitlint/" style="font-size: 14px; color: #999">commitlint</a> <a href="/tags/puppeteer/" style="font-size: 14px; color: #999">puppeteer</a> <a href="/tags/react/" style="font-size: 14px; color: #999">react</a> <a href="/tags/typescript/" style="font-size: 14px; color: #999">typescript</a> <a href="/tags/vue/" style="font-size: 14px; color: #999">vue</a> <a href="/tags/位移运算/" style="font-size: 14px; color: #999">位移运算</a> <a href="/tags/单例模式/" style="font-size: 14px; color: #999">单例模式</a> <a href="/tags/原型链/" style="font-size: 14px; color: #999">原型链</a> <a href="/tags/又是一年/" style="font-size: 20.67px; color: #6c6c6c">又是一年</a> <a href="/tags/好物推荐/" style="font-size: 17.33px; color: #828282">好物推荐</a> <a href="/tags/工厂模式/" style="font-size: 14px; color: #999">工厂模式</a> <a href="/tags/数据结构/" style="font-size: 14px; color: #999">数据结构</a> <a href="/tags/构建工具/" style="font-size: 14px; color: #999">构建工具</a> <a href="/tags/柯里化/" style="font-size: 14px; color: #999">柯里化</a> <a href="/tags/观察者模式/" style="font-size: 14px; color: #999">观察者模式</a> <a href="/tags/读书笔记/" style="font-size: 20.67px; color: #6c6c6c">读书笔记</a> <a href="/tags/进程与线程/" style="font-size: 14px; color: #999">进程与线程</a> <a href="/tags/面试经历/" style="font-size: 14px; color: #999">面试经历</a> <a href="/tags/项目与项目经理/" style="font-size: 14px; color: #999">项目与项目经理</a>
    </div>
  </section>


      
    
  
    
      
      
        
  <section class="category">
    
<header class="pure">
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;所有分类</div>
  
</header>

    <div class="content pure">
      <ul class="entry">
        
          <li><a class="flat-box" title="/categories/PMP之路/" href="/categories/PMP之路/"><div class="name">PMP之路</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/fabricjs/" href="/categories/fabricjs/"><div class="name">fabricjs</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/xxx/" href="/categories/xxx/"><div class="name">xxx</div><div class="badge">(0)</div></a></li>
        
          <li><a class="flat-box" title="/categories/前端工程化/" href="/categories/前端工程化/"><div class="name">前端工程化</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/基础原理/" href="/categories/基础原理/"><div class="name">基础原理</div><div class="badge">(2)</div></a></li>
        
          <li><a class="flat-box" title="/categories/学习笔记/" href="/categories/学习笔记/"><div class="name">学习笔记</div><div class="badge">(3)</div></a></li>
        
          <li><a class="flat-box" title="/categories/年终总结/" href="/categories/年终总结/"><div class="name">年终总结</div><div class="badge">(4)</div></a></li>
        
          <li><a class="flat-box" title="/categories/微前端/" href="/categories/微前端/"><div class="name">微前端</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/我爱折腾/" href="/categories/我爱折腾/"><div class="name">我爱折腾</div><div class="badge">(2)</div></a></li>
        
          <li><a class="flat-box" title="/categories/服务器操作/" href="/categories/服务器操作/"><div class="name">服务器操作</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/每日一题/" href="/categories/每日一题/"><div class="name">每日一题</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/浏览器/" href="/categories/浏览器/"><div class="name">浏览器</div><div class="badge">(2)</div></a></li>
        
          <li><a class="flat-box" title="/categories/移动端开发/" href="/categories/移动端开发/"><div class="name">移动端开发</div><div class="badge">(2)</div></a></li>
        
          <li><a class="flat-box" title="/categories/算法相关/" href="/categories/算法相关/"><div class="name">算法相关</div><div class="badge">(2)</div></a></li>
        
          <li><a class="flat-box" title="/categories/编码规范/" href="/categories/编码规范/"><div class="name">编码规范</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/装机必备/" href="/categories/装机必备/"><div class="name">装机必备</div><div class="badge">(2)</div></a></li>
        
          <li><a class="flat-box" title="/categories/设计模式/" href="/categories/设计模式/"><div class="name">设计模式</div><div class="badge">(6)</div></a></li>
        
          <li><a class="flat-box" title="/categories/译文/" href="/categories/译文/"><div class="name">译文</div><div class="badge">(4)</div></a></li>
        
          <li><a class="flat-box" title="/categories/进阶心法/" href="/categories/进阶心法/"><div class="name">进阶心法</div><div class="badge">(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/项目部署/" href="/categories/项目部署/"><div class="name">项目部署</div><div class="badge">(3)</div></a></li>
        
      </ul>
    </div>
  </section>


      
    
  


        </aside>
        <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
    <footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="mailto:me@rocwong.cn" class="social fas fa-envelope flat-btn" target="_blank" rel="external"></a>
        
      
        
          <a href="https://github.com/rocwong-cn" class="social fab fa-github flat-btn" target="_blank" rel="external"></a>
        
      
        
          <a href="https://music.163.com/#/user/home?id=64405940" class="social fas fa-music flat-btn" target="_blank" rel="external"></a>
        
      
    </div>
  
  <br>
  <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
  <div>本站使用 <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a> 作为主题，总访问量为 <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span> 次。
  </div>
  <div><a href="http://www.beian.miit.gov.cn/" rel="nofollow">京ICP备18022839号-1</a></div>
</footer>

    <script>setLoadingBarProgress(80);</script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>


  
    <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
    <script type="text/javascript">
      $(function() {
        const $reveal = $('.reveal');
    		if ($reveal.length === 0) return;
    		const sr = ScrollReveal({ distance: 0 });
    		sr.reveal('.reveal');
      });
    </script>
  
  
    <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
    <script type="text/javascript">
      $(function() {
        Waves.attach('.flat-btn', ['waves-button']);
        Waves.attach('.float-btn', ['waves-button', 'waves-float']);
        Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
        Waves.attach('.flat-box', ['waves-block']);
        Waves.attach('.float-box', ['waves-block', 'waves-float']);
        Waves.attach('.waves-image');
        Waves.init();
      });
    </script>
  
  
    <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>
  
  
  

  
  
    
      
      
      
        
          <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
          
            
              <script src="/js/volantis.js"></script>
            
          
          <script>
          var GUEST_INFO = ['nick','mail','link'];
          var guest_info = 'nick,mail,link'.split(',').filter(function(item){
            return GUEST_INFO.indexOf(item) > -1
          });
          var notify = 'false' == true;
          var verify = 'false' == true;
          var valine = new Valine();
          valine.init({
            el: '#valine_container',
            notify: notify,
            verify: verify,
            guest_info: guest_info,
            
            appId: "gYp5OOFzzylucF3XlyJk6T5a-gzGzoHsz",
            appKey: "fzh2pJLE0OYsBEt718W40wfB",
            placeholder: "快来评论吧~",
            pageSize:'10',
            avatar:'monsterid',
            lang:'zh-cn',
            highlight:''
          })
          </script>
        
      
    
  
  
    <script src="/js/app.js"></script>
<script src="/js/search.js"></script>
  






    <script>setLoadingBarProgress(100);</script>
</body>
</html>
